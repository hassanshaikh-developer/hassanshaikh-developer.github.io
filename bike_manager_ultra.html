<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Bike Manager Ultra+</title>
  <meta name="description" content="Advanced offline-first bike inventory manager with AI-powered analytics, photo management, and seamless sync." />

  <!-- Web App Manifest -->
  <link rel="manifest" href="data:application/manifest+json;base64,ew0KICAibmFtZSI6ICJCaWtlIE1hbmFnZXIgVWx0cmErIiwNCiAgInNob3J0X25hbWUiOiAiQk1VIiwNCiAgImRlc2NyaXB0aW9uIjogIkFkdmFuY2VkIG9mZmxpbmUtZmlyc3QgYmlrZSBpbnZlbnRvcnkgbWFuYWdlciB3aXRoIEFJLXBvd2VyZWQgYW5hbHl0aWNzLiIsDQogICJzdGFydF91cmwiOiAiLi8iLA0KICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwNCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzA3MTAyNiIsDQogICJ0aGVtZV9jb2xvciI6ICIjMDcxYjJiIiwNCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0LXByaW1hcnkiLA0KICAiaWNvbnMiOiBbDQogICAgew0KICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDE5MiAxOTInIGZpbGw9JyUyMzAwRDBGRiclM0UtcjZlY3Qgd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInIHJ4PSczMicgZmlsbD0nJTIzMDcxYjJiJy8+PHJlY3Qgd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInIHJ4PSczMicgZmlsbD0nJTIzMDcxYjJiJy8+PHRleHQgeD0nNTAlMjUnIHk9JzUwJTI1JyBkb21pbmFudC1iYXNlbGluZT0nY2VudHJhbCcgdGV4dC1hbmNob3I9J21pZGRsZScgZm9udC1zaXplPSc5NicgZm9udC1mYW1pbHk9J3NhbnMtc2VyaWYnIGZpbGw9J3doaXRlJyBmb250LXdlaWdodD0nYm9sZCc+Qk1VPC90ZXh0Pjwvc3ZnPg0KICAgICAgIiwNCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLA0KICAgICAgInNpemVzIjogIjE5MngxOTIiLA0KICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIg0KICAgIH0sDQogICAgew0KICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDUxMiA1MTInIGZpbGw9JyUyMzAwRDBGRiclM0UtPHJlY3Qgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIHJ4PSc2NCcgZmlsbD0nJTIzMDcxYjJiJy8+PHJlY3Qgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIHJ4PSc2NCcgZmlsbD0nJTIzMDcxYjJiJy8+PHRleHQgeD0nNTAlMjUnIHk9JzUwJTI1JyBkb21pbmFudC1iYXNlbGluZT0nY2VudHJhbCcgdGV4dC1hbmNob3I9J21pZGRsZScgZm9udC1zaXplPScyNTYnIGZvbnQtZmFtaWx5PSdzYW5zLXNlcmlmJyBmaWxsPSd3aGl0ZScgZm9udC13ZWlnaHQ9J2JvbGQnPkJNVTwvdGV4dD48L3N2Zz4NCiAgICAgICIsDQogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwNCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIg0KICAgIH0NCiAgXQ0KfQ0K" />

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="BMU+" />
  <meta name="theme-color" content="#071b2b" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192' fill='%2300D0FF'%3E%3Crect width='192' height='192' rx='32' fill='%23071b2b'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='96' font-family='sans-serif' fill='white' font-weight='bold'%3EBMU%2B%3C/text%3E%3C/svg%3E" />

  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/dexie@4.0.1/dist/dexie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/intro.min.js"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />

  <!-- Inline Styles -->
  <style>
    /* CSS Variables */
    :root {
      /* Colors */
      --primary: #00D0FF;
      --primary-light: #66e0ff;
      --primary-dark: #0090cc;
      --secondary: #6EE7B7;
      --secondary-light: #a3f0d8;
      --secondary-dark: #3ec99a;
      --accent: #FF6B6B;
      --accent-light: #ff9999;
      --accent-dark: #e55555;
      --success: #22c55e;
      --warning: #f59e0b;
      --error: #ef4444;

      /* Dark Theme (Default) */
      --bg-primary: #071b2b;
      --bg-secondary: #0a2339;
      --bg-tertiary: #0f2d47;
      --bg-card: rgba(15, 45, 71, 0.7);
      --bg-overlay: rgba(7, 27, 43, 0.85);
      --text-primary: #ffffff;
      --text-secondary: #b8c7d9;
      --text-tertiary: #7a8c9e;
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.4);

      /* Light Theme */
      --light-bg-primary: #f4f7fa;
      --light-bg-secondary: #ffffff;
      --light-bg-tertiary: #e8eef3;
      --light-bg-card: rgba(255, 255, 255, 0.9);
      --light-bg-overlay: rgba(244, 247, 250, 0.9);
      --light-text-primary: #071b2b;
      --light-text-secondary: #4a5a70;
      --light-text-tertiary: #7a8c9e;
      --light-border-color: rgba(0, 0, 0, 0.1);
      --light-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      --light-shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);

      /* Layout */
      --sidebar-width: 280px;
      --header-height: 70px;
      --fab-size: 56px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Light Theme Override */
    body.light-theme {
      --bg-primary: var(--light-bg-primary);
      --bg-secondary: var(--light-bg-secondary);
      --bg-tertiary: var(--light-bg-tertiary);
      --bg-card: var(--light-bg-card);
      --bg-overlay: var(--light-bg-overlay);
      --text-primary: var(--light-text-primary);
      --text-secondary: var(--light-text-secondary);
      --text-tertiary: var(--light-text-tertiary);
      --border-color: var(--light-border-color);
      --shadow: var(--light-shadow);
      --shadow-lg: var(--light-shadow-lg);
    }

    /* Base Styles */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 16px;
      transition: var(--transition);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* App Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
      position: relative;
    }

    /* Sidebar Navigation */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--bg-secondary);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
      transition: var(--transition);
      box-shadow: var(--shadow-lg);
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .nav-menu {
      padding: 20px 0;
      flex-grow: 1;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 24px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      position: relative;
    }

    .nav-item:hover {
      color: var(--text-primary);
      background-color: rgba(255, 255, 255, 0.05);
    }

    .nav-item.active {
      color: var(--primary);
      background-color: rgba(0, 208, 255, 0.1);
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--primary);
      border-radius: 0 4px 4px 0;
    }

    .nav-icon {
      font-size: 24px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: var(--transition);
    }

    /* Header */
    .header {
      height: var(--header-height);
      background-color: var(--bg-card);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      padding: 0 24px;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .header-title {
      font-size: 24px;
      font-weight: 700;
      margin-right: auto;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .search-container {
      position: relative;
      width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 10px 16px 10px 44px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-color);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 14px;
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 208, 255, 0.2);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
    }

    /* Content Area */
    .content {
      padding: 24px;
      flex-grow: 1;
    }

    .view {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .view.active {
      display: block;
    }

    /* Cards */
    .card {
      background-color: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid var(--border-color);
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background-color: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
    }

    .stat-card.primary::before {
      background-color: var(--primary);
    }

    .stat-card.secondary::before {
      background-color: var(--secondary);
    }

    .stat-card.accent::before {
      background-color: var(--accent);
    }

    .stat-card.success::before {
      background-color: var(--success);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin: 8px 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .stat-change {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--error);
    }

    /* Bike List */
    .bike-list {
      display: grid;
      gap: 16px;
    }

    .bike-card {
      background-color: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid var(--border-color);
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 16px;
      align-items: center;
      cursor: pointer;
    }

    .bike-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .bike-checkbox {
      width: 24px;
      height: 24px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .bike-card.selected .bike-checkbox {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .bike-card.selected .bike-checkbox::after {
      content: '✓';
      color: white;
      font-size: 14px;
    }

    .bike-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .bike-plate {
      font-size: 18px;
      font-weight: 600;
    }

    .bike-owner {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .bike-profit {
      font-size: 18px;
      font-weight: 700;
      text-align: right;
    }

    .bike-profit.positive {
      color: var(--success);
    }

    .bike-profit.negative {
      color: var(--error);
    }

    .bike-profit.unsold {
      color: var(--text-tertiary);
      font-style: italic;
    }

    /* Filters */
    .filter-container {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 6px 12px;
      border-radius: var(--radius-full);
      background-color: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid var(--border-color);
    }

    .chip:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .chip.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .sort-dropdown {
      position: relative;
    }

    .sort-button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: var(--radius-md);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition);
    }

    .sort-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .sort-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: var(--bg-card);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-color);
      z-index: 10;
      min-width: 180px;
      margin-top: 8px;
      display: none;
    }

    .sort-menu.active {
      display: block;
    }

    .sort-option {
      padding: 10px 16px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
    }

    .sort-option:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .sort-option.active {
      background-color: rgba(0, 208, 255, 0.1);
      color: var(--primary);
    }

    /* FAB */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: var(--fab-size);
      height: var(--fab-size);
      border-radius: var(--radius-xl);
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      z-index: 90;
      transition: var(--transition);
    }

    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 30px rgba(0, 208, 255, 0.4);
    }

    .fab:active {
      transform: scale(0.95);
    }

    /* Modals */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--bg-overlay);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background-color: var(--bg-card);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      transform: scale(0.9);
      transition: var(--transition);
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background-color: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-close:hover {
      background-color: var(--accent);
      color: white;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 16px;
      transition: var(--transition);
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 208, 255, 0.2);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: var(--radius-md);
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 208, 255, 0.3);
    }

    .btn-secondary {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .btn-danger {
      background-color: var(--error);
      color: white;
    }

    .btn-danger:hover {
      background-color: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(239, 68, 68, 0.3);
    }

    /* Charts */
    .chart-container {
      height: 300px;
      margin-top: 20px;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile Responsive */
    .menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 110;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }

    .menu-toggle:hover {
      background-color: var(--bg-tertiary);
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .menu-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .search-container {
        width: 100%;
        margin: 16px 0;
      }

      .header {
        padding: 16px;
        flex-wrap: wrap;
      }

      .header-title {
        width: 100%;
        margin-bottom: 16px;
        text-align: center;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }

    /* Toast Styles */
    .toast {
      background-color: var(--bg-card);
      color: var(--text-primary);
      padding: 16px 24px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      border-left: 4px solid var(--primary);
    }

    .toast.success {
      border-left-color: var(--success);
    }

    .toast.error {
      border-left-color: var(--error);
    }

    .toast.warning {
      border-left-color: var(--warning);
    }

    /* Loading Spinner */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--border-color);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Empty State */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .empty-state-description {
      max-width: 400px;
    }
  </style>
</head>
<body>
  <!-- App Container -->
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">BMU+</div>
        <h1 class="app-title">Bike Manager Ultra+</h1>
      </div>

      <nav class="nav-menu">
        <a href="#" class="nav-item active" data-view="dashboard">
          <span class="nav-icon material-icons-round">dashboard</span>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-view="bikes">
          <span class="nav-icon material-icons-round">pedal_bike</span>
          <span>Bikes</span>
        </a>
        <a href="#" class="nav-item" data-view="analytics">
          <span class="nav-icon material-icons-round">analytics</span>
          <span>Analytics</span>
        </a>
        <a href="#" class="nav-item" data-view="settings">
          <span class="nav-icon material-icons-round">settings</span>
          <span>Settings</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <button class="menu-toggle" id="menu-toggle">
          <span class="material-icons-round">menu</span>
        </button>

        <h2 class="header-title" id="header-title">Dashboard</h2>

        <div class="header-actions">
          <div class="search-container">
            <span class="material-icons-round search-icon">search</span>
            <input type="text" class="search-input" id="search-input" placeholder="Search bikes..." />
          </div>

          <button class="btn btn-primary" id="sync-btn">
            <span class="material-icons-round">sync</span>
            <span>Sync</span>
          </button>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content">
        <!-- Dashboard View -->
        <section class="view active" id="dashboard-view">
          <div class="stats-grid">
            <div class="stat-card primary">
              <div class="stat-label">Total Bikes</div>
              <div class="stat-value" id="total-bikes">0</div>
              <div class="stat-change positive">
                <span class="material-icons-round">trending_up</span>
                <span>+12%</span>
              </div>
            </div>

            <div class="stat-card secondary">
              <div class="stat-label">Total Profit</div>
              <div class="stat-value" id="total-profit">₹0</div>
              <div class="stat-change positive">
                <span class="material-icons-round">trending_up</span>
                <span>+8%</span>
              </div>
            </div>

            <div class="stat-card accent">
              <div class="stat-label">Sold This Month</div>
              <div class="stat-value" id="sold-month">0</div>
              <div class="stat-change negative">
                <span class="material-icons-round">trending_down</span>
                <span>-3%</span>
              </div>
            </div>

            <div class="stat-card success">
              <div class="stat-label">Average ROI</div>
              <div class="stat-value" id="avg-roi">0%</div>
              <div class="stat-change positive">
                <span class="material-icons-round">trending_up</span>
                <span>+5%</span>
              </div>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">insights</span>
              AI Insights
            </h3>
            <div id="ai-insights">
              <p>Your most profitable bike model is <strong>Hero Splendor+</strong> with an average profit of ₹5,200.</p>
              <p>Consider increasing inventory of <strong>Royal Enfield Classic</strong> models as they sell 30% faster.</p>
              <p>Your profit margin has improved by 4% this month. Keep up the good work!</p>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">show_chart</span>
              Recent Activity
            </h3>
            <div class="chart-container">
              <canvas id="activity-chart"></canvas>
            </div>
          </div>
        </section>

        <!-- Bikes View -->
        <section class="view" id="bikes-view">
          <div class="filter-container">
            <div class="filter-chips">
              <div class="chip active" data-filter="all">All</div>
              <div class="chip" data-filter="available">Available</div>
              <div class="chip" data-filter="sold">Sold</div>
              <div class="chip" data-filter="maintenance">Maintenance</div>
            </div>

            <div class="sort-dropdown">
              <button class="sort-button" id="sort-button">
                <span>Sort By</span>
                <span class="material-icons-round">arrow_drop_down</span>
              </button>
              <div class="sort-menu" id="sort-menu">
                <div class="sort-option active" data-sort="date-added">Date Added</div>
                <div class="sort-option" data-sort="plate">Plate Number</div>
                <div class="sort-option" data-sort="owner">Owner Name</div>
                <div class="sort-option" data-sort="profit">Profit</div>
                <div class="sort-option" data-sort="roi">ROI</div>
              </div>
            </div>
          </div>

          <div class="bike-list" id="bike-list">
            <!-- Bikes will be dynamically added here -->
          </div>

          <div class="empty-state" id="bikes-empty">
            <div class="empty-state-icon material-icons-round">pedal_bike</div>
            <div class="empty-state-title">No bikes yet</div>
            <p class="empty-state-description">Add your first bike to get started with tracking your inventory.</p>
          </div>
        </section>

        <!-- Analytics View -->
        <section class="view" id="analytics-view">
          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">bar_chart</span>
              Profit Trends
            </h3>
            <div class="chart-container">
              <canvas id="profit-chart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">pie_chart</span>
              Sales by Model
            </h3>
            <div class="chart-container">
              <canvas id="model-chart"></canvas>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">timeline</span>
              ROI Distribution
            </h3>
            <div class="chart-container">
              <canvas id="roi-chart"></canvas>
            </div>
          </div>
        </section>

        <!-- Settings View -->
        <section class="view" id="settings-view">
          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">palette</span>
              Appearance
            </h3>

            <div class="form-group">
              <label class="form-label">Theme</label>
              <select class="form-select" id="theme-select">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="system">System</option>
              </select>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">cloud_sync</span>
              Sync Settings
            </h3>

            <div class="form-group">
              <label class="form-label">GitHub Gist ID</label>
              <input type="text" class="form-input" id="gist-id" placeholder="Your Gist ID" />
            </div>

            <div class="form-group">
              <label class="form-label">Personal Access Token</label>
              <input type="password" class="form-input" id="pat-token" placeholder="ghp_..." />
            </div>

            <button class="btn btn-primary" id="save-sync-settings">
              <span class="material-icons-round">save</span>
              <span>Save Settings</span>
            </button>
          </div>

          <div class="card">
            <h3 class="card-title">
              <span class="material-icons-round">backup</span>
              Data Management
            </h3>

            <div class="form-row">
              <button class="btn btn-secondary" id="export-data">
                <span class="material-icons-round">download</span>
                <span>Export Data</span>
              </button>

              <button class="btn btn-secondary" id="import-data">
                <span class="material-icons-round">upload</span>
                <span>Import Data</span>
              </button>
            </div>

            <div class="form-group">
              <button class="btn btn-danger" id="reset-data">
                <span class="material-icons-round">delete_forever</span>
                <span>Reset All Data</span>
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- FAB -->
  <button class="fab" id="fab-add">
    <span class="material-icons-round">add</span>
  </button>

  <!-- Bike Form Modal -->
  <div class="modal-overlay" id="bike-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Add New Bike</h3>
        <button class="modal-close" id="close-modal">
          <span class="material-icons-round">close</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="bike-form">
          <input type="hidden" id="bike-id" />

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="bike-plate">Plate Number *</label>
              <input type="text" class="form-input" id="bike-plate" required placeholder="GJ05AB1234" />
            </div>

            <div class="form-group">
              <label class="form-label" for="bike-model">Model *</label>
              <input type="text" class="form-input" id="bike-model" required placeholder="Hero Splendor+" />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="bike-owner">Owner Name *</label>
            <input type="text" class="form-input" id="bike-owner" required placeholder="John Doe" />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="purchase-date">Purchase Date</label>
              <input type="date" class="form-input" id="purchase-date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="purchase-price">Purchase Price (₹)</label>
              <input type="number" class="form-input" id="purchase-price" placeholder="25000" step="0.01" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="sale-date">Sale Date</label>
              <input type="date" class="form-input" id="sale-date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="sale-price">Sale Price (₹)</label>
              <input type="number" class="form-input" id="sale-price" placeholder="30000" step="0.01" />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="repair-cost">Repair Cost (₹)</label>
            <input type="number" class="form-input" id="repair-cost" placeholder="2000" step="0.01" />
          </div>

          <div class="form-group">
            <label class="form-label" for="bike-status">Status</label>
            <select class="form-select" id="bike-status">
              <option value="available">Available</option>
              <option value="sold">Sold</option>
              <option value="maintenance">Maintenance</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="bike-notes">Notes</label>
            <textarea class="form-textarea" id="bike-notes" placeholder="Additional notes about the bike..."></textarea>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancel-btn">Cancel</button>
        <button class="btn btn-danger" id="delete-btn" style="display: none;">Delete</button>
        <button class="btn btn-primary" id="save-btn">
          <span class="material-icons-round">save</span>
          <span>Save</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- JavaScript Application -->
  <script>
    // App Constants
    const DB_NAME = 'BikeManagerUltraDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'bikes';
    const SETTINGS_KEY = 'bmu_settings';

    // Initialize App
    class BikeManagerUltra {
      constructor() {
        this.db = null;
        this.bikes = [];
        this.currentView = 'dashboard';
        this.currentFilter = 'all';
        this.currentSort = 'date-added';
        this.searchTerm = '';
        this.selectedBike = null;
        this.charts = {};
        this.settings = {
          theme: 'dark',
          gistId: '',
          patToken: '',
          currency: '₹'
        };

        // Initialize app
        this.init();
      }

      // Initialize the app
      async init() {
        // Initialize database
        await this.initDB();

        // Load settings
        this.loadSettings();

        // Setup event listeners
        this.setupEventListeners();

        // Load data
        await this.loadBikes();

        // Render initial view
        this.renderView();

        // Show welcome tour for first-time users
        if (!localStorage.getItem('bmu_tour_shown')) {
          this.showWelcomeTour();
          localStorage.setItem('bmu_tour_shown', 'true');
        }
      }

      // Initialize IndexedDB
      async initDB() {
        this.db = new Dexie(DB_NAME);
        this.db.version(DB_VERSION).stores({
          bikes: '++id, plate, model, owner, purchaseDate, saleDate, status, profit, roi, createdAt, updatedAt'
        });
        await this.db.open();
      }

      // Load settings from localStorage
      loadSettings() {
        const savedSettings = localStorage.getItem(SETTINGS_KEY);
        if (savedSettings) {
          this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
        }

        // Apply theme
        this.applyTheme(this.settings.theme);
      }

      // Save settings to localStorage
      saveSettings() {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(this.settings));
      }

      // Apply theme
      applyTheme(theme) {
        if (theme === 'system') {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.body.classList.toggle('light-theme', !prefersDark);
        } else {
          document.body.classList.toggle('light-theme', theme === 'light');
        }
      }

      // Setup event listeners
      setupEventListeners() {
        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            this.switchView(item.dataset.view);
          });
        });

        // Menu toggle for mobile
        document.getElementById('menu-toggle').addEventListener('click', () => {
          document.getElementById('sidebar').classList.toggle('active');
        });

        // Search
        document.getElementById('search-input').addEventListener('input', (e) => {
          this.searchTerm = e.target.value.toLowerCase();
          this.renderBikesList();
        });

        // Filter chips
        document.querySelectorAll('.chip').forEach(chip => {
          chip.addEventListener('click', () => {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            this.currentFilter = chip.dataset.filter;
            this.renderBikesList();
          });
        });

        // Sort dropdown
        document.getElementById('sort-button').addEventListener('click', () => {
          document.getElementById('sort-menu').classList.toggle('active');
        });

        document.querySelectorAll('.sort-option').forEach(option => {
          option.addEventListener('click', () => {
            document.querySelectorAll('.sort-option').forEach(o => o.classList.remove('active'));
            option.classList.add('active');
            this.currentSort = option.dataset.sort;
            document.getElementById('sort-button').querySelector('span').textContent = option.textContent;
            document.getElementById('sort-menu').classList.remove('active');
            this.renderBikesList();
          });
        });

        // FAB
        document.getElementById('fab-add').addEventListener('click', () => {
          this.openBikeModal();
        });

        // Modal controls
        document.getElementById('close-modal').addEventListener('click', () => {
          this.closeBikeModal();
        });

        document.getElementById('cancel-btn').addEventListener('click', () => {
          this.closeBikeModal();
        });

        document.getElementById('save-btn').addEventListener('click', () => {
          this.saveBike();
        });

        document.getElementById('delete-btn').addEventListener('click', () => {
          this.deleteBike();
        });

        // Settings
        document.getElementById('theme-select').addEventListener('change', (e) => {
          this.settings.theme = e.target.value;
          this.applyTheme(this.settings.theme);
          this.saveSettings();
        });

        document.getElementById('save-sync-settings').addEventListener('click', () => {
          this.settings.gistId = document.getElementById('gist-id').value;
          this.settings.patToken = document.getElementById('pat-token').value;
          this.saveSettings();
          this.showToast('Sync settings saved', 'success');
        });

        document.getElementById('export-data').addEventListener('click', () => {
          this.exportData();
        });

        document.getElementById('import-data').addEventListener('click', () => {
          this.importData();
        });

        document.getElementById('reset-data').addEventListener('click', () => {
          if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
            this.resetData();
          }
        });

        document.getElementById('sync-btn').addEventListener('click', () => {
          this.syncWithGist();
        });

        // Close sort menu when clicking outside
        document.addEventListener('click', (e) => {
          if (!e.target.closest('.sort-dropdown')) {
            document.getElementById('sort-menu').classList.remove('active');
          }
        });
      }

      // Switch view
      switchView(view) {
        this.currentView = view;

        // Update navigation
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.view === view);
        });

        // Update header title
        const titles = {
          'dashboard': 'Dashboard',
          'bikes': 'Bike Inventory',
          'analytics': 'Analytics',
          'settings': 'Settings'
        };
        document.getElementById('header-title').textContent = titles[view];

        // Update view visibility
        document.querySelectorAll('.view').forEach(v => {
          v.classList.remove('active');
        });
        document.getElementById(`${view}-view`).classList.add('active');

        // Render view-specific content
        this.renderView();
      }

      // Render current view
      async renderView() {
        switch (this.currentView) {
          case 'dashboard':
            this.renderDashboard();
            break;
          case 'bikes':
            this.renderBikesList();
            break;
          case 'analytics':
            this.renderAnalytics();
            break;
          case 'settings':
            this.renderSettings();
            break;
        }
      }

      // Load bikes from database
      async loadBikes() {
        this.bikes = await this.db.bikes.toArray();
      }

      // Save bike to database
      async saveBike() {
        const id = document.getElementById('bike-id').value;
        const plate = document.getElementById('bike-plate').value.trim();
        const model = document.getElementById('bike-model').value.trim();
        const owner = document.getElementById('bike-owner').value.trim();
        const purchaseDate = document.getElementById('purchase-date').value;
        const purchasePrice = parseFloat(document.getElementById('purchase-price').value) || 0;
        const saleDate = document.getElementById('sale-date').value;
        const salePrice = parseFloat(document.getElementById('sale-price').value) || 0;
        const repairCost = parseFloat(document.getElementById('repair-cost').value) || 0;
        const status = document.getElementById('bike-status').value;
        const notes = document.getElementById('bike-notes').value.trim();

        // Validation
        if (!plate || !model || !owner) {
          this.showToast('Please fill in all required fields', 'error');
          return;
        }

        // Calculate profit and ROI
        const investment = purchasePrice + repairCost;
        const profit = salePrice - investment;
        const roi = investment > 0 ? (profit / investment) * 100 : 0;

        const bikeData = {
          plate,
          model,
          owner,
          purchaseDate,
          purchasePrice,
          saleDate,
          salePrice,
          repairCost,
          status,
          notes,
          profit,
          roi,
          updatedAt: new Date().toISOString()
        };

        try {
          if (id) {
            // Update existing bike
            await this.db.bikes.update(parseInt(id), bikeData);
            this.showToast('Bike updated successfully', 'success');
          } else {
            // Add new bike
            bikeData.createdAt = new Date().toISOString();
            await this.db.bikes.add(bikeData);
            this.showToast('Bike added successfully', 'success');
          }

          // Close modal and refresh
          this.closeBikeModal();
          await this.loadBikes();
          this.renderView();
        } catch (error) {
          console.error('Error saving bike:', error);
          this.showToast('Failed to save bike', 'error');
        }
      }

      // Delete bike
      async deleteBike() {
        const id = document.getElementById('bike-id').value;

        if (!id) return;

        if (confirm('Are you sure you want to delete this bike? This action cannot be undone.')) {
          try {
            await this.db.bikes.delete(parseInt(id));
            this.showToast('Bike deleted successfully', 'success');
            this.closeBikeModal();
            await this.loadBikes();
            this.renderView();
          } catch (error) {
            console.error('Error deleting bike:', error);
            this.showToast('Failed to delete bike', 'error');
          }
        }
      }

      // Open bike modal
      openBikeModal(bike = null) {
        const modal = document.getElementById('bike-modal');
        const title = document.getElementById('modal-title');

        // Reset form
        document.getElementById('bike-form').reset();
        document.getElementById('bike-id').value = '';
        document.getElementById('delete-btn').style.display = 'none';

        if (bike) {
          // Edit existing bike
          title.textContent = 'Edit Bike';
          document.getElementById('bike-id').value = bike.id;
          document.getElementById('bike-plate').value = bike.plate;
          document.getElementById('bike-model').value = bike.model;
          document.getElementById('bike-owner').value = bike.owner;
          document.getElementById('purchase-date').value = bike.purchaseDate;
          document.getElementById('purchase-price').value = bike.purchasePrice;
          document.getElementById('sale-date').value = bike.saleDate;
          document.getElementById('sale-price').value = bike.salePrice;
          document.getElementById('repair-cost').value = bike.repairCost;
          document.getElementById('bike-status').value = bike.status;
          document.getElementById('bike-notes').value = bike.notes;
          document.getElementById('delete-btn').style.display = 'flex';
        } else {
          // Add new bike
          title.textContent = 'Add New Bike';
          document.getElementById('purchase-date').value = new Date().toISOString().split('T')[0];
          document.getElementById('bike-status').value = 'available';
        }

        // Show modal
        modal.classList.add('active');
      }

      // Close bike modal
      closeBikeModal() {
        document.getElementById('bike-modal').classList.remove('active');
      }

      // Render bikes list
      renderBikesList() {
        let filteredBikes = [...this.bikes];

        // Apply search filter
        if (this.searchTerm) {
          filteredBikes = filteredBikes.filter(bike => 
            bike.plate.toLowerCase().includes(this.searchTerm) ||
            bike.model.toLowerCase().includes(this.searchTerm) ||
            bike.owner.toLowerCase().includes(this.searchTerm)
          );
        }

        // Apply status filter
        if (this.currentFilter !== 'all') {
          filteredBikes = filteredBikes.filter(bike => bike.status === this.currentFilter);
        }

        // Apply sorting
        filteredBikes.sort((a, b) => {
          switch (this.currentSort) {
            case 'plate':
              return a.plate.localeCompare(b.plate);
            case 'owner':
              return a.owner.localeCompare(b.owner);
            case 'profit':
              return (b.profit || 0) - (a.profit || 0);
            case 'roi':
              return (b.roi || 0) - (a.roi || 0);
            case 'date-added':
            default:
              return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
          }
        });

        const bikeList = document.getElementById('bike-list');
        const emptyState = document.getElementById('bikes-empty');

        if (filteredBikes.length === 0) {
          bikeList.style.display = 'none';
          emptyState.style.display = 'flex';
        } else {
          bikeList.style.display = 'grid';
          emptyState.style.display = 'none';

          bikeList.innerHTML = filteredBikes.map(bike => `
            <div class="bike-card ${bike.status === 'sold' ? 'sold' : ''}" data-id="${bike.id}">
              <div class="bike-checkbox"></div>
              <div class="bike-info">
                <div class="bike-plate">${bike.plate}</div>
                <div class="bike-owner">${bike.owner}</div>
              </div>
              <div class="bike-profit ${bike.status === 'sold' ? (bike.profit >= 0 ? 'positive' : 'negative') : 'unsold'}">
                ${bike.status === 'sold' ? `${this.settings.currency}${bike.profit.toFixed(2)}` : 'Unsold'}
              </div>
            </div>
          `).join('');

          // Add click event to bike cards
          document.querySelectorAll('.bike-card').forEach(card => {
            card.addEventListener('click', () => {
              const bikeId = parseInt(card.dataset.id);
              const bike = this.bikes.find(b => b.id === bikeId);
              if (bike) {
                this.openBikeModal(bike);
              }
            });
          });
        }
      }

      // Render dashboard
      renderDashboard() {
        // Calculate stats
        const totalBikes = this.bikes.length;
        const soldBikes = this.bikes.filter(bike => bike.status === 'sold');
        const totalProfit = soldBikes.reduce((sum, bike) => sum + (bike.profit || 0), 0);
        const avgRoi = soldBikes.length > 0 
          ? soldBikes.reduce((sum, bike) => sum + (bike.roi || 0), 0) / soldBikes.length 
          : 0;

        // Current month
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        const soldThisMonth = soldBikes.filter(bike => {
          const saleDate = new Date(bike.saleDate);
          return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
        }).length;

        // Update DOM
        document.getElementById('total-bikes').textContent = totalBikes;
        document.getElementById('total-profit').textContent = `${this.settings.currency}${totalProfit.toFixed(2)}`;
        document.getElementById('sold-month').textContent = soldThisMonth;
        document.getElementById('avg-roi').textContent = `${avgRoi.toFixed(1)}%`;

        // Render activity chart
        this.renderActivityChart();
      }

      // Render analytics
      renderAnalytics() {
        // Destroy existing charts
        Object.values(this.charts).forEach(chart => {
          if (chart) chart.destroy();
        });

        // Render charts
        this.renderProfitChart();
        this.renderModelChart();
        this.renderRoiChart();
      }

      // Render settings
      renderSettings() {
        document.getElementById('theme-select').value = this.settings.theme;
        document.getElementById('gist-id').value = this.settings.gistId;
        document.getElementById('pat-token').value = this.settings.patToken;
      }

      // Render activity chart
      renderActivityChart() {
        const ctx = document.getElementById('activity-chart').getContext('2d');

        // Prepare data
        const last7Days = [];
        const salesData = [];

        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];

          last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));

          const salesCount = this.bikes.filter(bike => {
            if (!bike.saleDate) return false;
            const saleDate = new Date(bike.saleDate);
            return saleDate.toISOString().split('T')[0] === dateStr;
          }).length;

          salesData.push(salesCount);
        }

        // Create chart
        this.charts.activity = new Chart(ctx, {
          type: 'line',
          data: {
            labels: last7Days,
            datasets: [{
              label: 'Bikes Sold',
              data: salesData,
              borderColor: getComputedStyle(document.documentElement).getPropertyValue('--primary'),
              backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--primary') + '20',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1
                }
              }
            }
          }
        });
      }

      // Render profit chart
      renderProfitChart() {
        const ctx = document.getElementById('profit-chart').getContext('2d');

        // Group by month
        const monthlyProfit = {};

        this.bikes.filter(bike => bike.status === 'sold').forEach(bike => {
          if (!bike.saleDate) return;

          const date = new Date(bike.saleDate);
          const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;

          monthlyProfit[monthKey] = (monthlyProfit[monthKey] || 0) + (bike.profit || 0);
        });

        // Sort and format data
        const sortedMonths = Object.keys(monthlyProfit).sort();
        const labels = sortedMonths.map(month => {
          const [year, month] = month.split('-');
          return new Date(year, month - 1).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        });

        const data = sortedMonths.map(month => monthlyProfit[month]);

        // Create chart
        this.charts.profit = new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Monthly Profit',
              data,
              backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--primary')
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return '₹' + value;
                  }
                }
              }
            }
          }
        });
      }

      // Render model chart
      renderModelChart() {
        const ctx = document.getElementById('model-chart').getContext('2d');

        // Count by model
        const modelCount = {};

        this.bikes.filter(bike => bike.status === 'sold').forEach(bike => {
          modelCount[bike.model] = (modelCount[bike.model] || 0) + 1;
        });

        // Sort and format data
        const sortedModels = Object.keys(modelCount).sort((a, b) => modelCount[b] - modelCount[a]);
        const labels = sortedModels.slice(0, 5); // Top 5 models
        const data = labels.map(model => modelCount[model]);

        // Create chart
        this.charts.model = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels,
            datasets: [{
              data,
              backgroundColor: [
                getComputedStyle(document.documentElement).getPropertyValue('--primary'),
                getComputedStyle(document.documentElement).getPropertyValue('--secondary'),
                getComputedStyle(document.documentElement).getPropertyValue('--accent'),
                getComputedStyle(document.documentElement).getPropertyValue('--success'),
                getComputedStyle(document.documentElement).getPropertyValue('--warning')
              ]
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right'
              }
            }
          }
        });
      }

      // Render ROI chart
      renderRoiChart() {
        const ctx = document.getElementById('roi-chart').getContext('2d');

        // Create ROI ranges
        const roiRanges = {
          'Negative': 0,
          '0-10%': 0,
          '10-20%': 0,
          '20-50%': 0,
          '50%+': 0
        };

        this.bikes.filter(bike => bike.status === 'sold').forEach(bike => {
          const roi = bike.roi || 0;

          if (roi < 0) {
            roiRanges['Negative']++;
          } else if (roi < 10) {
            roiRanges['0-10%']++;
          } else if (roi < 20) {
            roiRanges['10-20%']++;
          } else if (roi < 50) {
            roiRanges['20-50%']++;
          } else {
            roiRanges['50%+']++;
          }
        });

        // Create chart
        this.charts.roi = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: Object.keys(roiRanges),
            datasets: [{
              label: 'Number of Bikes',
              data: Object.values(roiRanges),
              backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary')
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1
                }
              }
            }
          }
        });
      }

      // Export data
      exportData() {
        const dataStr = JSON.stringify(this.bikes, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });

        saveAs(dataBlob, `bike-manager-data-${new Date().toISOString().split('T')[0]}.json`);
        this.showToast('Data exported successfully', 'success');
      }

      // Import data
      importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';

        input.onchange = async (e) => {
          const file = e.target.files[0];
          if (!file) return;

          try {
            const text = await file.text();
            const data = JSON.parse(text);

            if (!Array.isArray(data)) {
              throw new Error('Invalid data format');
            }

            // Clear existing data
            await this.db.bikes.clear();

            // Add imported data
            await this.db.bikes.bulkAdd(data);

            // Reload and render
            await this.loadBikes();
            this.renderView();

            this.showToast('Data imported successfully', 'success');
          } catch (error) {
            console.error('Error importing data:', error);
            this.showToast('Failed to import data', 'error');
          }
        };

        input.click();
      }

      // Reset all data
      async resetData() {
        try {
          await this.db.bikes.clear();
          await this.loadBikes();
          this.renderView();
          this.showToast('All data has been reset', 'success');
        } catch (error) {
          console.error('Error resetting data:', error);
          this.showToast('Failed to reset data', 'error');
        }
      }

      // Sync with GitHub Gist
      async syncWithGist() {
        if (!this.settings.gistId || !this.settings.patToken) {
          this.showToast('Please configure sync settings first', 'error');
          return;
        }

        try {
          this.showToast('Syncing with GitHub Gist...', 'info');

          // Export data
          const dataStr = JSON.stringify(this.bikes, null, 2);

          // Upload to Gist
          const response = await fetch(`https://api.github.com/gists/${this.settings.gistId}`, {
            method: 'PATCH',
            headers: {
              'Authorization': `token ${this.settings.patToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              files: {
                'bike-manager-data.json': {
                  content: dataStr
                }
              }
            })
          });

          if (response.ok) {
            this.showToast('Synced successfully with GitHub Gist', 'success');
          } else {
            throw new Error('Sync failed');
          }
        } catch (error) {
          console.error('Error syncing with Gist:', error);
          this.showToast('Failed to sync with GitHub Gist', 'error');
        }
      }

      // Show welcome tour
      showWelcomeTour() {
        introJs().setOptions({
          steps: [
            {
              element: '#sidebar',
              intro: 'This is the navigation menu. Use it to switch between different sections of the app.',
              position: 'right'
            },
            {
              element: '#header-title',
              intro: 'This shows the current section you are viewing.',
              position: 'bottom'
            },
            {
              element: '#search-input',
              intro: 'Use this search bar to quickly find bikes by plate number, model, or owner name.',
              position: 'bottom'
            },
            {
              element: '#fab-add',
              intro: 'Click this button to add a new bike to your inventory.',
              position: 'left'
            },
            {
              element: '.stats-grid',
              intro: 'These cards show key metrics about your bike business.',
              position: 'top'
            }
          ],
          showProgress: true,
          showBullets: false,
          exitOnOverlayClick: true,
          exitOnEsc: true,
          nextLabel: 'Next',
          prevLabel: 'Previous',
              doneLabel: 'Done'
            }).start();
          }

          // Show toast notification
          showToast(message, type = 'info') {
            Toastify({
              text: message,
              duration: 3000,
              gravity: 'bottom',
              position: 'right',
              backgroundColor: type === 'error' ? 'var(--error)' : 
                               type === 'success' ? 'var(--success)' : 
                               type === 'warning' ? 'var(--warning)' : 'var(--primary)',
              stopOnFocus: true
            }).showToast();
          }
        }

        // Initialize app
        const app = new BikeManagerUltra();
      </script>
</body>
</html>