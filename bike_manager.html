<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Bike Manager — Extended</title>
  <meta name="description" content="Offline-first bike inventory manager with CSV/GitHub sync, import/export, search, filters and more." />
  <link rel="icon" href="data:;base64,iVBORw0KGgo="> 
  <style>
    :root{--bg:#071026;--card:#071b2b;--accent:#00d0ff;--muted:#9fb0c2;--text:#e6f6ff;--radius:12px}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, Poppins, system-ui, sans-serif;background:linear-gradient(180deg,#071026 0%,#020511 100%);color:var(--text);min-height:100vh;display:flex;justify-content:center;padding:20px}
    .wrap{width:100%;max-width:1100px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:1.4rem;background:linear-gradient(90deg,var(--accent),#6ee7b7);-webkit-background-clip:text;color:transparent}
    .note{color:var(--muted);font-size:0.9rem}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;font-weight:600;color:#00242f;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:16px;margin-top:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    form.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    label{display:block;color:var(--muted);font-size:0.85rem;margin-bottom:6px}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .actions{grid-column:1/-1;display:flex;gap:8px;flex-wrap:wrap}
    table{width:100%;border-collapse:collapse;margin-top:12px;border-radius:10px;overflow:hidden}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03);font-size:0.9rem}
    th{color:var(--muted);background:rgba(255,255,255,0.01)}
    tr:hover{background:rgba(255,255,255,0.02);cursor:pointer}
    .selected{background:linear-gradient(90deg,rgba(0,208,255,0.06),rgba(0,208,255,0.02))}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .search{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .small{padding:6px 8px;font-size:0.9rem;border-radius:8px}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    .stat{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;min-width:120px}
    .muted{color:var(--muted)}
    .flex{display:flex;gap:8px;align-items:center}
    .file-drop{border:2px dashed rgba(255,255,255,0.03);padding:12px;border-radius:10px;text-align:center;color:var(--muted)}
    .pagination{display:flex;gap:6px;align-items:center}
    @media(max-width:700px){.stats{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Bike Manager — Extended</h1>
        <div class="note">Offline-first. Save locally, import/export CSV/XLSX. Optionally sync to GitHub (requires token).</div>
      </div>
      <div class="controls toolbar">
        <input id="search" class="search" placeholder="Search owner, plate..." />
        <button id="btnAdd" title="Add new record">Add</button>
        <button id="btnImport" class="ghost">Import CSV</button>
        <button id="btnExportCSV" class="ghost">Export CSV</button>
        <button id="btnSaveGithub" class="ghost">Sync → GitHub</button>
        <button id="btnUndo" class="ghost" title="Undo last change">Undo</button>
        <button id="btnSample" class="ghost">Insert Sample</button>
      </div>
    </header>

    <section class="card">
      <form id="bikeForm" class="grid" onsubmit="return false;">
        <div>
          <label for="colNo">Bike Number (e.g. GJ05AB1234)</label>
          <input id="colNo" type="text" placeholder="GJ05AB1234" />
        </div>
        <div>
          <label for="owner">Owner name</label>
          <input id="owner" />
        </div>
        <div>
          <label for="purchasePrice">Purchase price</label>
          <input id="purchasePrice" type="number" step="0.01" />
        </div>
        <div>
          <label for="repairCost">Repair cost</label>
          <input id="repairCost" type="number" step="0.01" value="0" />
        </div>
        <div>
          <label for="sellingPrice">Selling price</label>
          <input id="sellingPrice" type="number" step="0.01" />
        </div>
        <div>
          <label for="netProfit">Net profit (auto)</label>
          <input id="netProfit" type="number" step="0.01" readonly />
        </div>
        <div>
          <label for="datePurchase">Date of purchase</label>
          <input id="datePurchase" type="date" />
        </div>
        <div>
          <label for="dateSelling">Date of selling</label>
          <input id="dateSelling" type="date" />
        </div>

        <div class="actions">
          <div class="flex">
            <button id="btnSaveLocal" class="small">Save Local</button>
            <button id="btnUpdate" class="ghost small">Update</button>
            <button id="btnDelete" class="ghost small">Delete</button>
            <button id="btnClear" class="ghost small">Clear</button>
          </div>
          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <label class="muted">Rows per page</label>
            <select id="pageSize" class="small"><option>10</option><option>20</option><option>50</option></select>
          </div>
        </div>
      </form>

      <div style="margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div class="file-drop" id="dropZone">Drop CSV here to import</div>
        <div class="muted">Or use Import button. Duplicate plate detection will be offered.</div>
      </div>

      <div class="stats" id="stats"></div>

      <table id="table" aria-describedby="tableDesc">
        <thead>
          <tr>
            <th data-key="no">No ▲▼</th>
            <th data-key="owner">Owner ▲▼</th>
            <th data-key="purchasePrice">Purchase ▲▼</th>
            <th data-key="repairCost">Repair ▲▼</th>
            <th data-key="sellingPrice">Selling ▲▼</th>
            <th data-key="netProfit">Net ▲▼</th>
            <th data-key="datePurchase">Purchased</th>
            <th data-key="dateSelling">Sold</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="tableDesc" class="note">Click a row to select; click headers to sort. Use search/filter for fast access.</div>

      <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center">
        <div class="pagination" id="pagination"></div>
        <div class="flex">
          <button id="btnCopy" class="ghost small">Copy CSV</button>
          <button id="btnPrint" class="ghost small">Print</button>
        </div>
      </div>

    </section>

    <div style="margin-top:12px" class="note">Tip: To host on GitHub Pages push this file to your repo (e.g. index.html). To store a CSV in the repo automatically, use the GitHub Sync button and provide a personal access token with repo access — see comments in the code. Storing directly in the repo requires authentication (the app cannot write to static hosting without it).</div>
  </div>

  <input id="fileInput" type="file" accept="text/csv" style="display:none" />

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    // STORAGE & CONFIG
    const STORAGE_KEY = 'bikes_db_v2';
    const CSV_FILENAME = 'bikes_db.csv';
    let db = [];
    let selectedIndex = -1;
    let sortState = {key:'',dir:1};
    let undoStack = [];

    const els = {
      colNo: document.getElementById('colNo'), owner:document.getElementById('owner'),
      purchasePrice: document.getElementById('purchasePrice'), repairCost:document.getElementById('repairCost'),
      sellingPrice:document.getElementById('sellingPrice'), netProfit:document.getElementById('netProfit'),
      datePurchase:document.getElementById('datePurchase'), dateSelling:document.getElementById('dateSelling'),
      btnAdd:document.getElementById('btnAdd'), btnSaveLocal:document.getElementById('btnSaveLocal'), btnUpdate:document.getElementById('btnUpdate'),
      btnDelete:document.getElementById('btnDelete'), btnClear:document.getElementById('btnClear'), tbody:document.querySelector('#table tbody'),
      search:document.getElementById('search'), btnImport:document.getElementById('btnImport'), btnExportCSV:document.getElementById('btnExportCSV'),
      fileInput:document.getElementById('fileInput'), dropZone:document.getElementById('dropZone'), stats:document.getElementById('stats'),
      btnSaveGithub:document.getElementById('btnSaveGithub'), btnUndo:document.getElementById('btnUndo'), btnSample:document.getElementById('btnSample'),
      pageSize:document.getElementById('pageSize'), pagination:document.getElementById('pagination'), btnCopy:document.getElementById('btnCopy'), btnPrint:document.getElementById('btnPrint')
    };

    function round2(v){return Math.round((v+Number.EPSILON)*100)/100}
    function formatNum(n){return Number(n).toLocaleString(undefined,{maximumFractionDigits:2})}
    function escapeHtml(s){return String(s).replace(/[&<>\'\"]/g,function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"}[c]||c})}

    function load(){ try{ db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch(e){ db=[] } render(); }
    function saveLocal(pushUndo=true){ if(pushUndo){undoStack.push(JSON.stringify(db)); if(undoStack.length>50) undoStack.shift()} localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); render(); }

    function isValidPlate(s){ s = (s||'').toUpperCase().trim(); // loose check: must start with 2 letters and end with digits
      if(s.length<4) return false; const a = s.charCodeAt(0); if(a<65||a>90) return false; const b=s.charCodeAt(1); if(b<65||b>90) return false; // has digits somewhere
      for(let i=2;i<s.length;i++){ if(s.charCodeAt(i)>=48 && s.charCodeAt(i)<=57) return true; } return false; }

    function readForm(){ const no = (els.colNo.value||'').trim().toUpperCase(); const owner = (els.owner.value||'').trim(); if(!isValidPlate(no)){ alert('Enter valid Indian bike number e.g. GJ05AB1234'); return null; } const purchasePrice = Number(els.purchasePrice.value)||0; const repairCost = Number(els.repairCost.value)||0; const sellingPrice = Number(els.sellingPrice.value)||0; const netProfit = round2(sellingPrice - (purchasePrice + repairCost)); if(!owner){ alert('Owner name required'); return null; } return { no, owner, purchasePrice, repairCost, sellingPrice, netProfit, datePurchase:els.datePurchase.value||'', dateSelling:els.dateSelling.value||'' }; }

    function addRecord(){ const rec = readForm(); if(!rec) return; const dup = db.findIndex(r=>r.no===rec.no); if(dup>=0){ if(!confirm('Plate exists. Replace existing record? Cancel to keep both.')){ db.push(rec); saveLocal(); clearForm(); return; } else { pushUndo(); db[dup]=rec; saveLocal(); clearForm(); return; } } pushUndo(); db.push(rec); saveLocal(); clearForm(); }
    function updateRecord(){ if(selectedIndex<0) return alert('Select a record first'); const rec=readForm(); if(!rec) return; pushUndo(); db[selectedIndex]=rec; saveLocal(); }
    function deleteRecord(){ if(selectedIndex<0) return alert('Select a record first'); if(!confirm('Delete selected record?')) return; pushUndo(); db.splice(selectedIndex,1); selectedIndex=-1; saveLocal(); clearForm(); }
    function clearForm(){ els.colNo.value=''; els.owner.value=''; els.purchasePrice.value=''; els.repairCost.value='0'; els.sellingPrice.value=''; els.netProfit.value=''; els.datePurchase.value=''; els.dateSelling.value=''; selectedIndex=-1; Array.from(els.tbody.children).forEach(r=>r.classList.remove('selected')); }

    function pushUndo(){ undoStack.push(JSON.stringify(db)); if(undoStack.length>50) undoStack.shift(); }
    function undo(){ if(undoStack.length===0){ alert('Nothing to undo'); return; } db = JSON.parse(undoStack.pop()); saveLocal(false); }

    function selectRow(i,tr){ selectedIndex=i; const r=db[i]; els.colNo.value=r.no; els.owner.value=r.owner; els.purchasePrice.value=r.purchasePrice; els.repairCost.value=r.repairCost; els.sellingPrice.value=r.sellingPrice; els.netProfit.value=r.netProfit; els.datePurchase.value=r.datePurchase||''; els.dateSelling.value=r.dateSelling||''; Array.from(els.tbody.children).forEach((row,idx)=>row.classList.toggle('selected', idx===i)); }

    function computeNet(){ const p=Number(els.purchasePrice.value)||0; const r=Number(els.repairCost.value)||0; const s=Number(els.sellingPrice.value)||0; els.netProfit.value=round2(s-(p+r)); }
    els.purchasePrice.addEventListener('input', computeNet); els.repairCost.addEventListener('input', computeNet); els.sellingPrice.addEventListener('input', computeNet);

    function render(){ const q = (els.search.value||'').trim().toLowerCase(); const pageSize = Number(els.pageSize.value)||10; let list = db.slice(); if(q){ list = list.filter(r=> (r.no||'').toLowerCase().includes(q) || (r.owner||'').toLowerCase().includes(q) ); } if(sortState.key){ list.sort((a,b)=>{ const ka=a[sortState.key]; const kb=b[sortState.key]; if(typeof ka==='number' && typeof kb==='number') return (ka-kb)*sortState.dir; return (String(ka||'').localeCompare(String(kb||'')))*sortState.dir; }); }
      const page = Number(localStorage.getItem('bikes_page')||1); const totalPages = Math.max(1, Math.ceil(list.length / pageSize)); const currentPage = Math.min(page, totalPages); localStorage.setItem('bikes_page', currentPage); const start = (currentPage-1)*pageSize; const visible = list.slice(start, start+pageSize);
      els.tbody.innerHTML=''; visible.forEach((r,i)=>{ const idx=start+i; const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(r.no)}</td><td>${escapeHtml(r.owner)}</td><td>${formatNum(r.purchasePrice)}</td><td>${formatNum(r.repairCost)}</td><td>${formatNum(r.sellingPrice)}</td><td>${formatNum(r.netProfit)}</td><td>${r.datePurchase||''}</td><td>${r.dateSelling||''}</td>`; tr.addEventListener('click',()=>selectRow(idx,tr)); if(idx===selectedIndex) tr.classList.add('selected'); els.tbody.appendChild(tr); }); renderStats(list); renderPagination(currentPage, totalPages); }

    function renderStats(list){ const totalPurchase = round2(list.reduce((s,r)=>s+(Number(r.purchasePrice)||0),0)); const totalRepair = round2(list.reduce((s,r)=>s+(Number(r.repairCost)||0),0)); const totalSelling = round2(list.reduce((s,r)=>s+(Number(r.sellingPrice)||0),0)); const totalNet = round2(list.reduce((s,r)=>s+(Number(r.netProfit)||0),0)); els.stats.innerHTML=`<div class="stat"><div class="muted">Records</div><div><strong>${list.length}</strong></div></div><div class="stat"><div class="muted">Total Purchase</div><div>₹ ${formatNum(totalPurchase)}</div></div><div class="stat"><div class="muted">Total Repair</div><div>₹ ${formatNum(totalRepair)}</div></div><div class="stat"><div class="muted">Total Selling</div><div>₹ ${formatNum(totalSelling)}</div></div><div class="stat"><div class="muted">Net Profit</div><div>₹ ${formatNum(totalNet)}</div></div>`; }

    function renderPagination(current, total){ els.pagination.innerHTML=''; const make=(t,disabled)=>{ const b=document.createElement('button'); b.textContent=t; b.className='small ghost'; if(disabled) b.disabled=true; return b; };
      const prev = make('Prev', current<=1); prev.addEventListener('click',()=>{ localStorage.setItem('bikes_page', Math.max(1,current-1)); render(); }); els.pagination.appendChild(prev);
      const info=document.createElement('div'); info.textContent=`Page ${current} / ${total}`; info.className='muted'; els.pagination.appendChild(info);
      const next = make('Next', current>=total); next.addEventListener('click',()=>{ localStorage.setItem('bikes_page', Math.min(total,current+1)); render(); }); els.pagination.appendChild(next);
    }

    function downloadCSV(filename=CSV_FILENAME){ if(db.length===0) return alert('Nothing to export'); const header = ['no','owner','purchasePrice','repairCost','sellingPrice','netProfit','datePurchase','dateSelling'].join(',') + '\n'; const rows = db.map(r=> [r.no,r.owner,r.purchasePrice,r.repairCost,r.sellingPrice,r.netProfit,r.datePurchase||'',r.dateSelling||''].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([header+rows],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); }

    function downloadExcel(filename='bikes_export.xlsx'){ if(db.length===0) return alert('Nothing to export'); const ws = XLSX.utils.json_to_sheet(db); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Bikes'); XLSX.writeFile(wb, filename); }

    function importCSVText(text){ const lines = text.split('\n').map(l=>l.trim()).filter(Boolean); if(lines.length===0) return; const headers = lines[0].split(',').map(h=>h.replace(/^\"|\"$/g,'').trim()); const rows = lines.slice(1).map(l=>{ // naive split, supports quoted fields without commas inside
        return l.split(',').map(c=>c.replace(/^\"|\"$/g,'').trim()); }); const imported = rows.map(r=>{ const obj={}; headers.forEach((h,i)=>obj[h]=r[i]||''); return { no:(obj.no||obj.No||'').toUpperCase(), owner:obj.owner||'', purchasePrice:Number(obj.purchasePrice||0), repairCost:Number(obj.repairCost||0), sellingPrice:Number(obj.sellingPrice||0), netProfit:round2(Number(obj.netProfit)|| (Number(obj.sellingPrice||0) - (Number(obj.purchasePrice||0)+Number(obj.repairCost||0)))), datePurchase:obj.datePurchase||'', dateSelling:obj.dateSelling||'' }; }); let added=0,replaced=0,skipped=0; imported.forEach(rec=>{ const idx=db.findIndex(r=>r.no===rec.no); if(idx>=0){ const keep = confirm('Record for '+rec.no+' exists. OK to replace? (Cancel to skip)'); if(keep){ pushUndo(); db[idx]=rec; replaced++; } else skipped++; } else { pushUndo(); db.push(rec); added++; } }); saveLocal(); alert('Imported: ' + imported.length + ' (added ' + added + ', replaced ' + replaced + ', skipped ' + skipped + ')'); }

    els.btnImport.addEventListener('click',()=>els.fileInput.click()); els.fileInput.addEventListener('change', e=>{ const f=e.target.files[0]; if(!f) return; const rdr=new FileReader(); rdr.onload=()=>importCSVText(rdr.result); rdr.readAsText(f); els.fileInput.value=''; });

    ['dragenter','dragover'].forEach(ev=>els.dropZone.addEventListener(ev,e=>{ e.preventDefault(); e.stopPropagation(); els.dropZone.style.borderColor='rgba(0,208,255,0.6)'; })); ['dragleave','drop'].forEach(ev=>els.dropZone.addEventListener(ev,e=>{ e.preventDefault(); e.stopPropagation(); els.dropZone.style.borderColor=''; })); els.dropZone.addEventListener('drop', e=>{ const f = e.dataTransfer.files[0]; if(f){ const rdr=new FileReader(); rdr.onload=()=>importCSVText(rdr.result); rdr.readAsText(f); } });

    async function copyCSVToClipboard(){ if(db.length===0) return alert('Nothing to copy'); const header = ['no','owner','purchasePrice','repairCost','sellingPrice','netProfit','datePurchase','dateSelling'].join(',') + '\n'; const rows = db.map(r=> [r.no,r.owner,r.purchasePrice,r.repairCost,r.sellingPrice,r.netProfit,r.datePurchase||'',r.dateSelling||''].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); try{ await navigator.clipboard.writeText(header+rows); alert('CSV copied to clipboard'); }catch(e){ alert('Unable to copy. Use Export CSV button.'); } }

    async function githubLoad(owner, repo, path = CSV_FILENAME, branch='main', token){ const url = 'https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + encodeURIComponent(path) + '?ref=' + encodeURIComponent(branch); const r = await fetch(url, { headers: { Authorization:'token ' + token, Accept:'application/vnd.github.v3+json' } }); if(r.status===404) return null; if(!r.ok) throw new Error('Failed to read file: ' + r.statusText); const j = await r.json(); const text = atob(j.content.replace(/\n/g,'')); return {sha:j.sha, text}; }

    async function githubSave(owner, repo, path, branch='main', token, contentText, sha=null, message='Update bikes CSV from Bike Manager'){ const url = 'https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + encodeURIComponent(path); const body = { message: message, content: btoa(unescape(encodeURIComponent(contentText))), branch: branch }; if(sha) body.sha = sha; const r = await fetch(url, { method:'PUT', headers:{ Authorization:'token ' + token, Accept:'application/vnd.github.v3+json' }, body: JSON.stringify(body)}); if(!r.ok) throw new Error('Failed to save: ' + (await r.text())); return await r.json(); }

    async function handleGitHubSync(){ const owner = prompt('GitHub owner (username or org)'); if(!owner) return; const repo = prompt('Repository name'); if(!repo) return; const path = prompt('Path in repo to save CSV', CSV_FILENAME); if(!path) return; const branch = prompt('Branch', 'main') || 'main'; const token = prompt('Personal access token (min: repo contents access) — keep this secret'); if(!token) return; try{ const existing = await githubLoad(owner, repo, path, branch, token); if(existing){ if(!confirm('Found existing CSV in repo. Replace it with current local data? (Cancel to merge by appending)')){ importCSVText(existing.text); alert('Merged remote file into local DB. You can now press Sync again to push merged file.'); return; } }
        const header = ['no','owner','purchasePrice','repairCost','sellingPrice','netProfit','datePurchase','dateSelling'].join(',') + '\n'; const rows = db.map(r=> [r.no,r.owner,r.purchasePrice,r.repairCost,r.sellingPrice,r.netProfit,r.datePurchase||'',r.dateSelling||''].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); const content = header + rows; const res = await githubSave(owner, repo, path, branch, token, content, existing && existing.sha, 'Update bikes DB via app'); alert('Saved to GitHub: ' + res.content.path); }catch(e){ alert('GitHub sync failed: ' + e.message); } }

    function insertSample(){ pushUndo(); const sample = [ {no:'GJ05AB1234', owner:'Ravi Kumar', purchasePrice:25000, repairCost:1500, sellingPrice:32000, netProfit:round2(32000-(25000+1500)), datePurchase:'2024-08-01', dateSelling:''}, {no:'MH12CD4321', owner:'Sita Devi', purchasePrice:18000, repairCost:2000, sellingPrice:24000, netProfit:round2(24000-(18000+2000)), datePurchase:'2024-09-10', dateSelling:''} ]; sample.forEach(s=> db.push(s)); saveLocal(); }

    els.btnAdd.addEventListener('click', addRecord); els.btnSaveLocal.addEventListener('click', ()=>{ const rec=readForm(); if(!rec) return; pushUndo(); db.push(rec); saveLocal(); clearForm(); }); els.btnUpdate.addEventListener('click', updateRecord); els.btnDelete.addEventListener('click', deleteRecord); els.btnClear.addEventListener('click', ()=>{ if(confirm('Clear all data?')){ pushUndo(); db=[]; saveLocal(); clearForm(); }});
    els.search.addEventListener('input', ()=>{ localStorage.setItem('bikes_search', els.search.value); render(); }); els.btnExportCSV.addEventListener('click', ()=>downloadCSV()); document.querySelector('#table thead').addEventListener('click', (e)=>{ const th = e.target.closest('th'); if(!th) return; const key = th.dataset.key; if(!key) return; if(sortState.key===key) sortState.dir *= -1; else { sortState.key=key; sortState.dir=1; } render(); }); els.btnSaveGithub.addEventListener('click', handleGitHubSync); els.btnUndo.addEventListener('click', undo); els.btnSample.addEventListener('click', insertSample); els.pageSize.addEventListener('change', ()=>{ localStorage.setItem('bikes_page_size', els.pageSize.value); render(); }); els.btnCopy.addEventListener('click', copyCSVToClipboard); els.btnPrint.addEventListener('click', ()=>{ window.print(); });

    window.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='i'){ e.preventDefault(); els.fileInput.click(); } if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='e'){ e.preventDefault(); downloadCSV(); } if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); saveLocal(); alert('Saved locally'); } });

    (function init(){ els.search.value = localStorage.getItem('bikes_search')||''; els.pageSize.value = localStorage.getItem('bikes_page_size')||'10'; load(); })();

  </script>
</body>
</html>
